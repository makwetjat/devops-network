# Installations
sudo  dnf install python3
sudo dnf install git
sudo dnf install sshpass
# Add app user
useradd configwave
# Create app directory and clone repo
sudo mkdir -p /app/ # Only have to do it once
cd /app
mv devops-network devops-network_$(date +%Y%m%d_%H%M%S)
git clone https://github.com/makwetjat/devops-network.git
sudo chown -R configiwave:configiwave /app
sudo chmod -R 755 /app
# Setup virtual env
cd /app/devops-network/automation-ui
python3 -m venv venv       # ✅ creates the virtual environment folder named 'venv'
source venv/bin/activate   # ✅ activates 
pip install -r requirements.txt
pip install --upgrade pip
#

# Create a services file - /etc/systemd/system/automation-ui.service

[Unit]
Description=Automation UI FastAPI Service
After=network.target

[Service]
User=configiwave
Group=configiwave
WorkingDirectory=/app/devops-network/automation-ui
Environment="PATH=/app/devops-network/automation-ui/venv/bin"
ExecStart=/app/devops-network/automation-ui/venv/bin/uvicorn app:app --host 0.0.0.0 --port 8000

[Install]
WantedBy=multi-user.target

# Give the user rights to run the service
echo 'configwave ALL=NOPASSWD:/bin/systemctl *  automation-ui*'|tee /etc/sudoers.d/configwave

# Start and enable the service s
systemctl enable automation-ui.service
systemctl start automation-ui.service
systemctl status automation-ui.service